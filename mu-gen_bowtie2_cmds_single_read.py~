#!/bin/env python

import os
import sys
import glob

#################################################################################
# input and stuff
#################################################################################

if len(sys.argv) != 5:
    print "send a target path (in which all your fastq files reside), and an output path (in which your results will be stored) as parameters, \
it is gonna be amazing."
    print
    print "and here how your command line should look like:"
    print
    print "\python gen_bowtie_cmds.py /path/to/fastq/files/ /path/to/output/directory/ prefix name reference name\n"
    sys.exit()

target_dir = sys.argv[1]
output_dir = sys.argv[2]
#prefix name is the base name of your bowtie2-align command
prefix_name = sys.argv[3]
ref_name = sys.argv[4]

if not target_dir.startswith('/') or not output_dir.startswith('/'):
    print "please provide a full path (I mean, a path that starts with '/')"
    sys.exit()


if not os.path.exists(output_dir):
    try:
        os.makedirs(output_dir)
    except:
        print "output dir wasn't there, tried to create one, but it didn't work :/"
        sys.exit()

fasta_list = sorted(glob.glob(os.path.join(target_dir, '*.fa')))

for pair in fasta_list:
    print '- %s' % (os.path.basename(pair[0]))

print
try:
    raw_input("Does this fasta look right? If not, press CTRL+C, otherwise press ENTER to continue..")
except:
    print
    sys.exit()


#################################################################################
# business time
#################################################################################

script_template = """#!/bin/bash/
clusterize bowtie2 -x %(ref_name)s -U %(fasta)s -f -S %(output_dir)s%(prefix)s.sam """

params = {}
params['project'] = prefix_name
params['input_dir'] = target_dir
params['output_dir'] = output_dir
params['prefix'] = prefix_name
params['ref_name'] = ref_name
params['fasta'] = ','.join([os.path.join(target_dir,pair) for pair in fasta_list])


open('%s.shx' % params['project'], 'w').write(script_template % (params))
